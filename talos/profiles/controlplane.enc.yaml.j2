version: v1alpha1
debug: false
persist: true
machine:
  type: controlplane
  token: ENC[AES256_GCM,data:NbL5UhvSj/jC/BG3K+S831/SBfx/5E4=,iv:Xj/dGOmL4aUIHqWZcYYkIo2e7nOCrT6+GEEXbttiKek=,tag:lkvLdbxImhyzxCOWiWizpQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:nuBE5TDyYDNUIFuawPAHb2fUEEoZe7ne+0hj8PdKHb7djfKmFQXv7GBQPevxhetHtMO6iFrJnCnDguu6eQWqF/e8FYAD0eTTElD+o0buftGPG1XmAvb+D92gzSZ+kdqrITUlkhU+rksEC6kBaTsQXE5LfENGWahBucXV3T7tD6xJJErA3clUpiiGx6/voSOUkFFbFfM0F65s06eMzVzv3VGMMyfcQJQ5u4Ebty9czfPIeK7cY6eFQp0fP4/qNiAlZEATQF6laYRaCOus3ORs+PYkd5s2pI72I+zebantiL9G0MGwOdzmR+R96AgD2MsAHJlmJujZl0Aj+gPRxKDWQM2W1sURkHlSVebOKjTC+A2yelyFgmVD8Qx2QnWO0INoptMo51qsHt93VY7SjckVA/qv0rNvp/ynBPyUWblLm8Otd541rTjEkqNEzXiaNKWiCHTMOb8xRgFZfu6q2GEwWx1V4gYbLnQvfuEWC+UsAkn878eA2OeI9tv+ppYLrUX3HjHCkn4CM/CswVbsSCXrCNUoacRPLouO2UKj0QucdE3818Dv6smjFa7wsnnPaQogUHnfgCpDWuRRejgSC8bcvJv8wyW8LQrqvfsKeeotADa1vLDOl9cgnCR+rmqHW1o0QIr9HBV77Th9Z52GJom1n/Sp4q7BfXmjNx+VnpH+4e79jWrwiyXMFquTLp26BEAaFkNkD/AL9itKDUZZlDRr3ZOrr51FCuryy9L4Be4AnXeEIYKuwP6hwY+uPJqXiYexUP7zAtLiIc3kbZGf7To9lQRNcMs7Lw28E5ymJfq1wwR8W7NmIhUIUVpZAUisOw5+gsg2/oY7ntgnWDxhWTQRxNzrFSfmwhxIK12razu02ffMOz2y,iv:YNeZu75bdKwUhOW13rTj3CEh8JOCKDhV7qQRh0TXSnk=,tag:zcM8SQTuk2+yeksro92Reg==,type:str]
    key: ENC[AES256_GCM,data:bSD2Q+5Be2WIhX2qOdclL58Nms0uJsrmH7VR+02r3k3LeNqjhw+aJY0QzUXVBSLahjQNORbi87tc5/BlftCjIEJu0Hs6bIHLW+JfKHgWPbPzz5dvU9TRIux+IYtniLafU7WGr1aUGrc2CWICiV2ScIb7gciiagVFdsjWXv+/Rz6pMNDzjpmwvgosf5jq/Udj0cTzTzUDFzX9ZYStggeWX+tZXYctXI4EyxazXYAkmDSSb80G,iv:OEawr5Zqud3YxvKslibhHalN8xt4jQ4kbMQFOMRpTqo=,tag:ht5r5E5zDenSMLBeU3l8Zw==,type:str]
  certSANs:
    - 127.0.0.1
    - 192.168.45.40
  kubelet:
    image: ghcr.io/siderolabs/kubelet:{{ ENV.KUBERNETES_VERSION }}
    extraArgs:
      cloud-provider: external
      rotate-server-certificates: "true"
    extraConfig:
      imageGCHighThresholdPercent: 70
      imageGCLowThresholdPercent: 50
      shutdownGracePeriod: 60s
    extraMounts:
      - destination: /var/openebs/local
        type: bind
        source: /var/openebs/local
        options:
          - bind
          - rshared
          - rw
    defaultRuntimeSeccompProfileEnabled: true
    nodeIP:
      validSubnets:
        - 192.168.45.0/24
    disableManifestsDirectory: true
  network:
    interfaces:
      - deviceSelector:
          # Ensure PCI devices on nodes are selected
          busPath: 0000:*
        mtu: 9000
        dhcp: true
        vip:
          ip: 192.168.45.40
  install:
    diskSelector:
      type: ssd
      size: <= 128GB
    extraKernelArgs:
      - apparmor=0
      - mitigations=off
      - security=none
    image: factory.talos.dev/installer/{{ ENV.TALOS_SCHEMATIC_ID }}:{{ ENV.TALOS_VERSION }}
    wipe: true
  files:
    - path: /etc/cri/conf.d/20-customization.part
      op: create
      content: |
        [plugins."io.containerd.cri.v1.images"]
          discard_unpacked_layers = false
    - path: /etc/nfsmount.conf
      op: overwrite
      permissions: 420
      content: |-
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        nconnect=16
        noatime=True
  sysctls:
    # Watchdog
    fs.inotify.max_user_watches: 1048576
    fs.inotify.max_user_instances: 8192
    # Cloudflared / QUIC
    net.core.rmem_max: 67108864
    net.core.wmem_max: 67108864
    # PostgreSQL
    vm.nr_hugepages: 1024
  features:
    rbac: true
    stableHostname: true
    kubernetesTalosAPIAccess:
      enabled: true
      allowedRoles:
        - os:reader
      allowedKubernetesNamespaces:
        - kube-system
    apidCheckExtKeyUsage: true
    diskQuotaSupport: true
    kubePrism:
      enabled: true
      port: 7445
    hostDNS:
      enabled: true
      resolveMemberNames: true
      forwardKubeDNSToHost: false
cluster:
  id: ENC[AES256_GCM,data:5HP8XavnZOd2kGHkpsq0U9om2hcDXkoax6BK3G6VNUhaD+xOWz/WheHOa80=,iv:xHHJbWP/4RMFzt1ZEXTBbbk9lVEIC9yWeJTiVAMIoRc=,tag:W2QUseAvvCaOoJdZLMMFUg==,type:str]
  secret: ENC[AES256_GCM,data:fsMzOiq6C1olF3trN3R+KK7SjiNTiZ8G6GHVfoD++jINCnVn+yPgAwu20w8=,iv:rk8exOtkrlNBH3xxwawNexKmF+vEJxW/tB2uWifObH8=,tag:2eMrtyX67d2gEUpNBuknoQ==,type:str]
  controlPlane:
    endpoint: https://192.168.45.40:6443
  clusterName: home-cluster
  allowSchedulingOnMasters: true
  network:
    cni:
      name: none
    dnsDomain: cluster.local
    podSubnets:
      - 10.45.0.0/16
    serviceSubnets:
      - 10.46.0.0/16
  token: ENC[AES256_GCM,data:GC58A7Ei/OVZGqkQYwSFkmBVdyHUhWo=,iv:DgWYKsO+R7v5j1Z6m1P8Dx1wDIws8Aw23sUvos7+qY8=,tag:+xf40lRt7ScL1sCv5hQ4Vw==,type:str]
  secretboxEncryptionSecret: ENC[AES256_GCM,data:BDqquq2K+KnHoKggQajRGaOj2cylP4VLoX01sNGhNFQqnOnstEr6Z/HAUM0=,iv:RkL8oZhGTqZl3QY34WUnyyHXqnzPxaCeKeVfZfvVSaM=,tag:sLceproS4z+3oMO9ATmBHQ==,type:str]
  ca:
    crt: ENC[AES256_GCM,data:I/b1ftjDsu8LiA6zeRvGsXzf4TyPX0sonphsihlDX6SZgoGvUrMykvoNh5DDVR7ttdH+fMMyT5mabTbrOlnyZDRHz0azg9eVjk9woOgRothwXZoWGa+Yufa/zNVsu5Qec3XCsFMHfw3TEaV3j1drTNBx+uvBfzA4Pa5znFYBeoUWWfnK2G4ipWHNZxjWMgCFYj6CcpT/pPNhhI//quow0tg3dtue93nKXXJauNuIX1HhVAItv3Df/q0bisuAIZYtozsoKYpSM9YVYHOwti0pgobatE/CXn4X3WhknNavbbMOKxCT8OXdTAF+M5Zw9kK+qWKOaVFyyfNNOWqHhWCu4JiK6PeK6456iRF/RXopamqUpT1u+kbY4RNUTr8wyQJK/XzLcT+YQeUFCkfNW+LSYcyPVwINVPqtNcFf/NIHKoii4ICNIWt5INgQzumj06QARP6cinpBOTSG4SLV5Orej1JqStIK+C+aJPA3NlWvrGu6lwpKDEatafsbcur8B2owPhjE//sRmebfjnIoWq0COpgZPefEQJjMQOPwTWg5XA0R/2PhooYAxL68akOCZLw2jEHKNFfbz5pcRMJDasF2GEyJdpuNWdB8R8MplAjLyp26KgUYInoIjFHyLJvjZoamU3WEa18H07zMAU+e5uws9L37dWp/N4c67e+ijEunLKdQJv3cwnlA7QVSDm35M8LJnZsYBeuFx4z+ecfMb6oo5jlelxUBbHqQBlxWqecwgFpbu22gsOOykjHrL1AyVOTJmrn8uACUyLyUR8befQ7+mX8StB0zee8X1gHjHEU9r1mNyA6XzaNhfgE4Pi+0as97Wr/YuQp18DiPjn/pC++raa73toTx3oeGAhADhAP6DfCDzkEkEcwIcscwfNKPii+tyWIHTmeEgyil/YOADF8BsZJW4L/GpIXqrHfMogFcgB0QDUyykdPBAtml7KiRkMRYEcZ5/GwQ8IGnC8ReRRoZvOLiTUjNraQDQwTK0NN42rXnP75bt9QMICqoDDda1u4l0icwUh2XGPWimAUPI2RsZKgkwoP2CQBr1fYWMQ==,iv:qBl3+yFXta/cQLiQhkIJ3w+RmAELuOvgSvtnVtk8fzY=,tag:PvC6cUeW/jw/hAtDz3k9bw==,type:str]
    key: ENC[AES256_GCM,data:gMtmSOLQC0vzNn2PObXNMEsVof2GcJmJaYa9BemoN0VtGgXryVAMloIRgJCuESIuiv9jWJmOZYOTL9+AactpT4atCwAfSge74ih+AmZZ7kVnopnKSiS1HAKW5v2ERNlV2JipyQIyHlWKd4wupqyEh/2brm9UScuk87vfkozUc9K6lK6FLV+ACqaWJVCHv+Ngyus8aEoVu9NC+4SJyM0wD/nIewkmXAddkvx5d0H5tMpb52L+zSw1F84cfkyyLVDMGrFcGRcZLDZ2fETWG1bA6PR5eR+1WXpOl3rJTCT7Fx1035qEvV6I7LKxRd5RUpZdHh48fEVRiVenTVDkH5NrVRTbEaErM3kZyYFihgyvn6PDlZvbY505QlnzBXKqS1yGP0Pmtyn9ac0uiB08WJg/VQ==,iv:WkPt2l6t28gLoqMLtrvtCfHut7QrLxPPZ7S5XcO+gbo=,tag:Jc3oeZVQ8yb0yEuJhLUkrA==,type:str]
  aggregatorCA:
    crt: ENC[AES256_GCM,data:8kS+fMwqyVpjzoTuIor//jWRgJRaCsjmD31ESiJRVIiID7O2zrJVjOUAYnAfr6LJ+RbK6p6EDnlcPT4w7Dfoc0xDunOvsVhDIdE6wTqx8M/hoTfTra49Mc+WpixnaSbevceGAYJISsx2x6qKiiCiOPEF/zbjZBl80A0t4lu96N6wXic6UFTFQw4/vCMaDzWpUTBD7ZCCkrZuYuJGv4i/ZNc0BXxvyO4okmd9MlZ6K0qB+UrNL9CF7ua7bf16cDJJznmwOYfbO6KvziQXs9CCSTEVE9I4RfkPxSdsX0DObqa5i88B4/D5ujf9pD7tQ1yjYUzH6nMMUKhQZwkntap2fUdUrrf50Czfl5CSN71Fr1oyFxTzQd5hq6pRmh/9p1VBewVUUEM5+fSqlyCBTM8U8dk4UDHHZTqPYpTyJ4O4pAz6vYlDnd9IYIuv1aD+Kukqe4iERyDuX4oBqHwk/HnT2BAJ8MiHuP8cmzigM0xgJPrpF9v2GDWzUzkHQUu4OemmhPVUQ2yKnQXB5DNlD5k8ZqUr6knHBAZeKuUNDlBSXps5R+8bEERDc+57zT80Qu3Auo8G0S0K3+5w8ug2sM0GspacCS4T0RS4nNnff83/m0sXwg3hbaDY2Lu89H7+Q0lG2SqOWjwcZAqibPEt+q0DFAFFrg/UdWIcfojkxCv5B/ac+lUz2kFPR5ITO/e6g26b+4G+m4QJCcUDdZ9NB/3AG/zgif35+khwKG6c6t1cV4N3KiX+1gGcT0wqePpnWvbKjSppOzcLyNdzNe+JJMRlMxtRiRD3FNSLzVrSgSEcaUZ/LEvSWJLSSSDM2QbpwGc63PqLw+uLAEPxsmPOS7juXKl+zE5htXkYSpjLpv5v5FTYD+lD4VN4h6vX9iVzsULPGQpC71z9LMSfK1QLpSfSr7Uotz9BCujK+4JsMuaSxJe4GhThlsGk2YOQmhCSzcp4,iv:4pg+gcx8pzkLnxjeewYsMAMcTT/Q/SLWVltrdgZa1R8=,tag:NTmHDd0J0VWmje3zjaf2zQ==,type:str]
    key: ENC[AES256_GCM,data:g14bdXQlCG2GkSA7i6xpuri2YmA4cgWmG2/uUYakH4CBdwW8+kK8x6BRuiRtuNPI3Xn1CsgC2ZZna4gJ9g7jrEw6o9omq10axUJKeIMjPoqe6vDqUwWM+/doypmdvSEXg7W9CQ5XckI7sb9EYteGxpWVh3EzMX9qlzkRdL3DzWOqZZ5hnQr8r9kiwh/VkOfSoCwfIADyvKI7wLg7RbhyUn9Q/y0CXkf4Wvt7EnYetFjPQAgEfQiPit42uf8Zg7yTJHzv/7tSRGkWWz5Nkl3Qsy7yGa0GuhnAdtj25+dieioM7rlZt9oj6HEgQxRMrNWDEjXfA62uSH0NUkGmXDe6FoXZ+cIJgKnWhM5YdI4vi+l/GjxLu6gUquam9AskZ940TiCOpJbHLDYXAqZi2bk5Rw==,iv:6JR5kylBg90xw8SGVs8UUO1QwfuULOWTU8GzEW9OTwY=,tag:P/WqxoXcUjm9zqWegscRXw==,type:str]
  serviceAccount:
    key: ENC[AES256_GCM,data:3aHEb1RPQdOMmsuPRRkoN0/iiL4N8Pcmd8AlSaZLdr+bq6B1OYL8Tr1lCQuf9ZgBZc2m1gHhz6YUwslRMgnZCFC3FKWdFMuicro6ISAVyWZfc5PyexBLBL6/5tR1J/tbcbRiMJTq3VIh16/Ik5s7Z4kpfgjKjFbga6aVyNAFJXp2MPDwz1vrk5MALLHbkBsYojO3dAP1qWmjvqCqd6uYds2ZYaKj5tPu1gXMun0qwrGYQkED2gYzdenTVQdvNxzDi7lGcGGrXItZiNRdApRjOMfJq9C1rNUtz9n9yLPspHL7Joz0Wmg9m2jTjZWZQ6tZ5ACfRCtEjzw1GjGt3qAoKcnZXqVtTYM0OmatiiEOO1fUXo0dyWlRECQ0uMYIE4qe8m5zMIf81NUNn5G5mTgdpg==,iv:Um6eFUbQSFzlrkQOSU8+FzxFawlWpP1n5iHjvvx28Vw=,tag:jLIcyQ3yzUtZtJqLAz3W+w==,type:str]
  apiServer:
    image: registry.k8s.io/kube-apiserver:{{ ENV.KUBERNETES_VERSION }}
    extraArgs:
      anonymous-auth: "true"
    certSANs:
      - 127.0.0.1
      - 192.168.45.40
    disablePodSecurityPolicy: true
    auditPolicy:
      apiVersion: audit.k8s.io/v1
      kind: Policy
      rules:
        - level: Metadata
  controllerManager:
    image: registry.k8s.io/kube-controller-manager:{{ ENV.KUBERNETES_VERSION }}
    extraArgs:
      bind-address: 0.0.0.0
  proxy:
    disabled: true
  scheduler:
    image: registry.k8s.io/kube-scheduler:{{ ENV.KUBERNETES_VERSION }}
    extraArgs:
      bind-address: 0.0.0.0
    config:
      apiVersion: kubescheduler.config.k8s.io/v1
      kind: KubeSchedulerConfiguration
      profiles:
        - schedulerName: default-scheduler
          pluginConfig:
            - name: PodTopologySpread
              args:
                defaultingType: List
                defaultConstraints:
                  - maxSkew: 1
                    topologyKey: kubernetes.io/hostname
                    whenUnsatisfiable: ScheduleAnyway
  discovery:
    enabled: true
    registries:
      kubernetes:
        disabled: true
      service:
        disabled: false
  etcd:
    ca:
      crt: ENC[AES256_GCM,data:26HXHBOh0bOyMw1CKx5/D1lkHNp3Ha8X8ualsxkzXdoiXSWNM4X4Ch4TVtiRboBYxgOMpk9KhtU801CmDRLWP1XTPs31BlM33goUyxzx1M9huED4lqPCA0OIsd4H9BxYFwFAwpFw2+wEyiPAzKpsP89igQYwKPgutnQ/oCbF+4JPR8HlliJ5/Oa1Nl+oBFAxlHoPp7QUv9qz/u4PMDeDuVL4c39hwGytqDztYqtaIoxkVUxtx3NI1QdyHS8LfATedvZFP6e/3ETnVpZl3Fh8+F3cQm2pg4WbRX3jQWOqvfCXfLeba4P0/95VHKqMkNkAvY/MVFRs4Lk/Lo90FybEL+J/bDo3OBWcYsL+bJabwUf3hPi+uLZ7TJVzzkKHi8sWXw9Pz7U8p77dbzplQIbPy5+JOO6MXQ90RLvzZMhWts1S2VoHHnl3IsbyaItPFR4WidXQk+z8XW8m9aa3w0H0jqMmdxR74rcLc8zm3AAlDhzpOvKxJ5thpslClGp6LDBgvKKUBIYHYbKEoug1/Auu4yQAGA2de2Le11pq89ZswGXY74UjMBpg0ds8pSvbihWzjfGfGE0Ah8+X5y1MShuCVNGV0fpsAZx6q6n1MWKrXS7tV6YVaLh3QpHi+Gh6jVkeof7hJhIrCKurrwuzYV+DpPBZgfz208F0Jd45ICCEKOGEUrkUd6v8ovjFpjiAOh62BzQ/AqKpyluC2NIZLK7Rqglsqji6YNWD9IXz0PKwOtaCz1b24ZPBxr5Ee2QYcjYq9sB5mG9vyEMa3vSjru4HRMiPugVRi75pvJzdIEdz5xh4GJ3VFvlmOWuqFOpe3h3VIMcd0JTSQbfONh5h/nM7CjBhFzL/+T7fix7oB0Pxhz0EK1U9G/5TQCywgcXul2XIkmxcjagCHs2iXYY46pznztY4+/G1MbIfPRaxyJ45LbJAxLmmVPZJ/BLRyVgWk5x8ATMzkkIiUHnRusCg3YAXWLMUbylehW5f+x4Y9L5ZF1oFpyzhFeOTizGWTndyzTQFKKXOxQ==,iv:ZZsEZAL/cc9wvopHl1SOsg0F+xGb6Q/YotIUl0TxEWs=,tag:co4i7Tle9mufg5Y2+1yJkQ==,type:str]
      key: ENC[AES256_GCM,data:MNY0YL45ysCAJnwwXeGa0nGb2MvbSBFgRS9vmwZFjED5+d7Q1LBrHaaI1OC9DZEZhhoe023jIhy+fYFvDmR8fgyH4FJkBlAnlf7zNRcSGuOnHY/GProtTdtrG/g1b3wDbsaT0qUCGd1AFj6UzmnNSzj+azZDIWC+b460U6vx1Wl3yvydF78E/i+u3e4spK2yXWuQNUB+3rmuyJq9ykNhXK1fGHXwmBcCSdh2YlTZ8CB8lTbs3Qhxpr8sUOfsMB0L4Qapy2H/M9LlUlFgRVa1J8Oz797SoPKvhPjZkkD+JeL3biIJdEWA7A5xVtrXCvxtIohV07LfEN8xtJ9w1+1eBUOZFY7fimq/N9NehIXedOlWeENiwhBkjKzXppI7ygtSXXcnDYDBPlHMizP98SKxig==,iv:0x344TrPFROGVnF5vZJNTfmOPOXQfQ7DCOsDJp/gKVw=,tag:hS8HkB1zyYAHIVHwAAmRjw==,type:str]
    extraArgs:
      listen-metrics-urls: http://0.0.0.0:2381
    advertisedSubnets:
      - 192.168.45.0/24
sops:
  kms: []
  gcp_kms: []
  azure_kv: []
  hc_vault: []
  age:
    - recipient: age13g8vu0uypup5ulq059xrs0gh4nkecvhhpkqmjdp3gpuc4w8q9c4sjys65q
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBpVnRtczNTdFVHTDNIK2lk
        UXpVWTRIZitRWERwZlFYdFhTTTdKNy94aVRjClNiUVRPTXVQL1JOOEFMcEpXVmxP
        OFhFOUhzSzhoSzJsNDV6VlBHOG1LbVUKLS0tIDRSdXNSSUlTb1NjTFJxb1hMYm0w
        cjJ2a1FXMXVRK09RS1N1Mk1VRHFWa2cKYpwNMGfJZG0tV/N+QQtPEUpFkMGgTEOu
        cjnHAGRmffz855BmXQiJHiyBDFhDiOjHSuki1TgYqiTWg5A9bFTxVA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-01-06T03:33:12Z"
  mac: ENC[AES256_GCM,data:G55I/eLU2Z1cj8qh2XXcYRmr2ZUgo7aAZwiBnpmZIaOdU4eDU+q/JswMvlteerIagPNSYxoRQCccJ8s+OhcY8ExXa3UE7WGDSL/QdWXNPftBGOudb5WPfgx/cJz7g3NDAoquWxnnqTHes9U5S/ui+cZDCuW7fXgV2Ub7zm/w6Pw=,iv:2cFEEcgbhLdGKV0Nbooc9nDDdnSZ2SzEFZ4aVqht+Io=,tag:RsYnrfjnQ77gn7XrDfyWTw==,type:str]
  pgp: []
  encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
  mac_only_encrypted: true
  version: 3.9.3
